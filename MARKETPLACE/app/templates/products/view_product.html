{% extends "base.html" %}

{% block content %}
<div class="product-page">
    <!-- Product Header -->
    <div class="product-header">
        <a href="{{ url_for('products.all_products') }}" class="back-btn">
            <i class="fas fa-arrow-left"></i>
        </a>
        <h1 class="product-title">{{ product.title }}</h1>
    </div>

    <!-- Product Content -->
    <div class="product-content">
        <!-- Product Image -->
        <div class="product-image-section">
            {% if product.image %}
                <img src="{{ url_for('static', filename='uploads/product_images/' + product.image) }}" 
                     alt="{{ product.title }}" 
                     class="product-image">
            {% else %}
                <div class="product-image-placeholder">
                    <i class="fas fa-camera"></i>
                    <span>No Image Available</span>
                </div>
            {% endif %}
        </div>

        <!-- Product Details -->
        <div class="product-details">
            <!-- Price and Quick Info -->
            <div class="price-section">
                <h2 class="product-price">KES {{ "{:,.2f}".format(product.price) }}</h2>
                <div class="product-meta">
                    <span class="meta-badge condition">{{ product.condition|replace('_',' ')|title }}</span>
                    <span class="meta-badge category">{{ product.category.name if product.category else 'General' }}</span>
                </div>
            </div>

            <!-- Description -->
            <div class="description-section">
                <h3>Description</h3>
                <p class="product-description">{{ product.description }}</p>
            </div>

            <!-- Product Stats -->
            <div class="stats-section">
                <div class="stat-item">
                    <i class="fas fa-calendar"></i>
                    <span>Listed {{ product.created_at.strftime('%b %d, %Y') }}</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-user"></i>
                    <span>Seller: @{{ product.seller.username }}</span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-section">
                {% if current_user.is_authenticated %}
                    {% if product.seller_id == current_user.id %}
                        <!-- Seller Actions -->
                        <div class="seller-actions">
                            <a href="{{ url_for('products.edit_product', product_id=product.id) }}" 
                               class="btn btn-secondary">
                                <i class="fas fa-edit"></i> Edit Product
                            </a>
                            <a href="{{ url_for('products.edit_contact_details', product_id=product.id) }}" 
                               class="btn btn-outline">
                                <i class="fas fa-address-card"></i> Contact Details
                            </a>
                        </div>
                    {% else %}
                        <!-- Buyer Actions -->
                        {% if product.is_sold %}
                            <button class="btn btn-disabled" disabled>
                                <i class="fas fa-tag"></i> Sold Out
                            </button>
                        {% else %}
                            {% set user_has_access = product.is_unlocked_by(current_user) %}
                            {% if user_has_access %}
                                <!-- Already paid - show contact button -->
                                <a href="{{ url_for('products.view_buyer_contact', product_id=product.id) }}" 
                                   class="btn btn-primary btn-large">
                                    <i class="fas fa-address-card"></i> View Seller Contact
                                </a>
                            {% else %}
                                <!-- Need to pay - show unlock button -->
                                <a href="{{ url_for('products.unlock_product', product_id=product.id) }}" 
                                   class="btn btn-primary btn-large">
                                    <i class="fas fa-lock-open"></i> Unlock Contact Details
                                </a>
                            {% endif %}
                            
                            <!-- Additional buyer options -->
                            <div class="buyer-options">
                                <button class="btn btn-outline btn-small">
                                    <i class="fas fa-heart"></i> Save
                                </button>
                                <button class="btn btn-outline btn-small">
                                    <i class="fas fa-share"></i> Share
                                </button>
                            </div>
                        {% endif %}
                    {% endif %}
                {% else %}
                    <!-- Not logged in -->
                    <div class="guest-actions">
                        <a href="{{ url_for('auth.login', next=request.path) }}" 
                           class="btn btn-primary btn-large">
                            <i class="fas fa-sign-in-alt"></i> Login to Contact Seller
                        </a>
                        <p class="guest-note">Create an account to message the seller and unlock contact details</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Similar Products Section -->
    <div class="similar-products">
        <h3>Similar Products</h3>
        <div class="products-scroll">
            <!-- You can add similar products here later -->
            <div class="no-similar">
                <i class="fas fa-search"></i>
                <p>No similar products found</p>
            </div>
        </div>
    </div>
</div>

<style>
/* Main Container */
.product-page {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0;
    background: #0a0f1c;
    min-height: 100vh;
}

/* Header */
.product-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border-bottom: 1px solid #2d3748;
    background: #0a0f1c;
    position: sticky;
    top: 0;
    z-index: 100;
}

.back-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #1f2937;
    color: #e5e7eb;
    text-decoration: none;
    transition: all 0.3s ease;
}

.back-btn:hover {
    background: var(--primary);
    transform: translateX(-2px);
}

.product-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #e5e7eb;
    margin: 0;
    flex: 1;
}

/* Product Content */
.product-content {
    display: flex;
    flex-direction: column;
    gap: 0;
}

/* Image Section */
.product-image-section {
    width: 100%;
}

.product-image {
    width: 100%;
    height: 300px;
    object-fit: cover;
    display: block;
}

.product-image-placeholder {
    width: 100%;
    height: 300px;
    background: #1f2937;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #6b7280;
}

.product-image-placeholder i {
    font-size: 3rem;
    margin-bottom: 1rem;
}

/* Product Details */
.product-details {
    padding: 1.5rem;
}

/* Price Section */
.price-section {
    margin-bottom: 1.5rem;
}

.product-price {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary);
    margin: 0 0 1rem 0;
}

.product-meta {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.meta-badge {
    padding: 0.4rem 0.8rem;
    background: #1f2937;
    color: #e5e7eb;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.meta-badge.condition {
    background: rgba(59, 130, 246, 0.2);
    color: #60a5fa;
}

.meta-badge.category {
    background: rgba(16, 185, 129, 0.2);
    color: #34d399;
}

/* Description */
.description-section {
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #2d3748;
}

.description-section h3 {
    color: #e5e7eb;
    margin-bottom: 0.75rem;
    font-size: 1.1rem;
}

.product-description {
    color: #9ca3af;
    line-height: 1.6;
    margin: 0;
}

/* Stats */
.stats-section {
    margin-bottom: 2rem;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 0;
    color: #9ca3af;
    border-bottom: 1px solid #2d3748;
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-item i {
    color: var(--primary);
    width: 16px;
}

/* Action Section */
.action-section {
    margin-bottom: 2rem;
}

.btn-large {
    width: 100%;
    padding: 1rem 1.5rem;
    font-size: 1.1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.btn-small {
    padding: 0.6rem 1rem;
    font-size: 0.9rem;
}

.buyer-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
}

.seller-actions {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.guest-note {
    text-align: center;
    color: #9ca3af;
    font-size: 0.9rem;
    margin-top: 1rem;
}

/* Similar Products */
.similar-products {
    padding: 1.5rem;
    border-top: 1px solid #2d3748;
}

.similar-products h3 {
    color: #e5e7eb;
    margin-bottom: 1rem;
    font-size: 1.1rem;
}

.products-scroll {
    overflow-x: auto;
}

.no-similar {
    text-align: center;
    padding: 2rem;
    color: #6b7280;
}

.no-similar i {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: #4b5563;
}

/* Button Styles */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    font-size: 0.95rem;
}

.btn-primary {
    background: var(--primary);
    color: white;
}

.btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}

.btn-secondary {
    background: #374151;
    color: #e5e7eb;
}

.btn-secondary:hover {
    background: #4b5563;
}

.btn-outline {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
}

.btn-outline:hover {
    background: var(--primary);
    color: white;
}

.btn-disabled {
    background: #6b7280;
    color: #9ca3ab;
    cursor: not-allowed;
    opacity: 0.6;
}

.btn-disabled:hover {
    transform: none;
}

/* Desktop Styles */
@media (min-width: 768px) {
    .product-page {
        padding: 0;
    }

    .product-header {
        padding: 1.5rem 2rem;
    }

    .product-title {
        font-size: 1.5rem;
    }

    .product-content {
        flex-direction: row;
        padding: 2rem;
        gap: 2rem;
    }

    .product-image-section {
        flex: 1;
        min-width: 400px;
    }

    .product-image,
    .product-image-placeholder {
        height: 500px;
        border-radius: var(--radius);
    }

    .product-details {
        flex: 1;
        padding: 0;
    }

    .product-price {
        font-size: 2.5rem;
    }

    .seller-actions {
        flex-direction: row;
    }

    .buyer-options {
        grid-template-columns: repeat(4, 1fr);
    }

    .similar-products {
        padding: 2rem;
    }
}

/* Large Desktop */
@media (min-width: 1024px) {
    .product-content {
        padding: 2rem 3rem;
    }
}

/* Small Mobile Optimization */
@media (max-width: 360px) {
    .product-details {
        padding: 1rem;
    }

    .product-price {
        font-size: 1.75rem;
    }

    .btn-large {
        padding: 0.875rem 1.25rem;
        font-size: 1rem;
    }

    .product-meta {
        flex-direction: column;
        align-items: flex-start;
    }

    .meta-badge {
        width: fit-content;
    }
}

/* Dark mode enhancements */
@media (prefers-color-scheme: dark) {
    .product-page {
        background: #0a0f1c;
    }
}

/* Smooth transitions */
.product-page * {
    transition: all 0.2s ease;
}
</style>

<script>
// Add any interactive functionality here
document.addEventListener('DOMContentLoaded', function() {
    // Share functionality
    const shareButtons = document.querySelectorAll('.btn-outline');
    shareButtons.forEach(btn => {
        if (btn.querySelector('.fa-share')) {
            btn.addEventListener('click', function() {
                if (navigator.share) {
                    navigator.share({
                        title: '{{ product.title }}',
                        text: 'Check out this product on CampusMarket',
                        url: window.location.href
                    });
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(window.location.href).then(() => {
                        alert('Link copied to clipboard!');
                    });
                }
            });
        }
    });
});
</script>
{% endblock %}