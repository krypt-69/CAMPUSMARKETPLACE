{% extends "base.html" %}
{% block content %}
<div class="product-page" style="max-width:1000px;margin:2rem auto;padding:1.5rem;">
    <div style="display:flex;gap:2rem;flex-wrap:wrap;">
        <div style="flex:1;min-width:320px;">
            {% if product.image %}
                <img src="{{ url_for('static', filename='uploads/product_images/' + product.image) }}" alt="{{ product.title }}" style="width:100%;max-height:600px;object-fit:cover;border-radius:8px;">
            {% else %}
                <div style="width:100%;height:400px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;border-radius:8px;">
                    <i class="fas fa-camera" style="font-size:3rem;color:#9ca3af;"></i>
                </div>
            {% endif %}
        </div>

        <div style="flex:1;min-width:300px;">
            <h1 style="margin-top:0;">{{ product.title }}</h1>
            <p style="font-size:1.25rem;font-weight:700;">KES {{ "{:,.2f}".format(product.price) }}</p>

            <div style="margin:1rem 0;color:#6b7280;">
                <strong>Condition:</strong> {{ product.condition|replace('_',' ')|title }}<br>
                <strong>Category:</strong> {{ product.category.name if product.category else 'General' }}<br>
                <strong>Listed:</strong> {{ product.created_at.strftime('%b %d, %Y') }}
            </div>

            <div style="margin-top:1rem;">
                <h3>Description</h3>
                <p>{{ product.description }}</p>
            </div>

            <div style="margin-top:1rem;">
                {% if current_user.is_authenticated %}
                    {% if product.is_sold %}
                        <button class="btn btn-disabled" disabled>Sold</button>
                    {% else %}
                        <!-- If product requires payment to view seller contact, link to payment-required -->
                        {% if not product.is_active %}
                            <a href="{{ url_for('products.payment_required', product_id=product.id) }}" class="btn btn-primary">Pay to view contact</a>
                        {% else %}
                            <div style="margin-top:1rem;padding:1rem;border:1px solid #e5e7eb;border-radius:6px;">
                                <strong>Seller Contact</strong>
                                <p>{{ product.contact_info or 'Contact info hidden' }}</p>
                                <a href="mailto:{{ product.seller.email }}" class="btn btn-secondary">Email Seller</a>
                            </div>
                        {% endif %}
                    {% endif %}
                {% else %}
                    <p>Please <a href="{{ url_for('auth.login', next=request.path) }}">log in</a> to interact with the seller.</p>
                {% endif %}
            </div>

            <div style="margin-top:2rem;">
                <a href="{{ url_for('products.my_products_list') }}" class="btn btn-link">Back to my products</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
